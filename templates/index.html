<html lang="en" >
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Angular Material style sheet -->
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/angular_material/1.1.0-rc2/angular-material.min.css">
    <style type="text/css">
      md-list-item, md-list-item .md-list-item-inner {
          min-height: 88px !important;
          height: 90px !important;
      }
      .ranking, .parcial, .campeonato {
          font-size: large;
          font-weight: bold;
          margin-right: 12px;
          text-align: center;
      }
      .ranking {
          width: 25px;
      }
      .main-toolbar{
        background-color: #00693A;
      }
    </style>
  </head>
  
  <body>
    <div ng-controller="timesCtrl" ng-cloak="" ng-app="BlankApp" >
        <md-toolbar layout="row" class="md-hue-3">
          <div class="md-toolbar-tools  main-toolbar" layout-align="center center">
            <img src="/static/img/logo_pad.png" alt="">
          </div>
        </md-toolbar>

        <div layout="row" layout-align="center center">
          <md-list flex="50" flex-sm="100" flex-xs="100" class="md-dense"> 
            <div ng-repeat="time in times">
              <md-list-item class="md-3-line" ng-click="null">
                <span class="ranking" ng-style="getStyle($index)">{[$index+1]}</span>
                <img ng-src="{[time.url_escudo_png]}?{[$index]}" class="md-avatar" alt="{[time.nome]}">
                <div class="md-list-item-text" layout="column">
                  <h3 ng-style="getStyle($index)">{[ time.nome ]}</h3>
                  <h4 ng-style="getStyle($index)">{[ time.nome_cartola ]}</h4>
                  <span class="parcial md-secondary">{[ time.pontos.parcial | number:2 ]}</span>
                  <span class="campeonato md-secondary">{[ time.pontos.campeonato | number:2 ]}</span>
                </div>
              </md-list-item>
              <md-divider></md-divider>
            </div>
          </md-list>
        </div>




    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular-animate.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular-aria.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular-messages.min.js"></script>

    <!-- Angular Material Library -->
    <script src="https://ajax.googleapis.com/ajax/libs/angular_material/1.1.0-rc2/angular-material.min.js"></script>
    
    <!-- Your application bootstrap  -->
    <script type="text/javascript">    
      /**
       * You must include the dependency on 'ngMaterial' 
       */
      var app = angular.module('BlankApp', ['ngMaterial']);
      
      app.config(['$interpolateProvider', function ($interpolateProvider) {
        $interpolateProvider.startSymbol('{[');
        $interpolateProvider.endSymbol(']}');
      }]);
      
      app.controller('timesCtrl', ['$scope', '$http', '$filter', function($scope, $http, $filter) {

        $scope.times = [];
        $scope.getStyle = function (index) {
          // Prize zone
          if (index < 3) {
            return {'color': 'blue'};
          }
          
          // Barbecue zone
          if (index >= $scope.times.length - 4) {
            return {'color': 'red'};
          }
          
          // Michel's bitches zone
          var times = $scope.times.map(function (item, index) {
            return item["time_id"];
          });
          if (index > times.indexOf(3438309)) {
            return {'color': 'orange'};
          }
        };

        $http.get("/times/").success(function (times) {
          $scope.times = times;
          angular.forEach($scope.times, function (time) {
            time["pontos"]["parcial"] = undefined;
            $http.get("/times/" + time["slug"] + "/parciais/").success(function (parciais) {
              var parcial = parciais["total"]
              time["pontos"]["parcial"] = parcial;
              time["pontos"]["campeonato"] += parcial;
              $scope.times = $filter('orderBy')($scope.times, 'pontos.parcial', true);
            });
          });
        });

      }]);
    </script>
    
  </body>
</html>